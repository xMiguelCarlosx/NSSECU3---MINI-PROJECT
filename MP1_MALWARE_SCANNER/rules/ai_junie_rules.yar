rule Emotet_Loader_Signatures {
    meta:
        description = "Emotet loader/downloader indicators: mutexes, loader strings, and network patterns"
        author = "Generated for MP1 Malware Forensics Project"
        date = "2026-02-13"
        reference = "Emotet behavioral indicators"

    strings:
        // Known loader strings and mutex patterns (example tokens; tune with latest IOCs)
        $s_mutex1 = "Global\\EmoMutex"
        $s_mutex2 = "Global\\EmoLoader"
        $s_cmd1 = "schtasks /create"
        $s_cmd2 = "powershell -nop -w hidden -enc"
        $s_http1 = "GET /update.php"
        $s_http2 = "POST /check.php"
        $s_dll = "EmoLoader.dll"
        $s_pack = "UPX0" // common packer marker; optional

        // Generic suspicious API usage often seen in loaders
        $api_inj1 = "VirtualAllocEx"
        $api_inj2 = "WriteProcessMemory"
        $api_inj3 = "CreateRemoteThread"

    condition:
        // File must be PE and match a combination of loader indicators
        uint16(0) == 0x5A4D and
        (
            (any of ($s_mutex*) and any of ($s_cmd*)) or
            (any of ($s_http*) and any of ($api_inj*)) or
            (any of ($s_dll, $s_pack))
        )
}


rule LockBit_Style_Ransomware {
    meta:
        description = "Detects LockBit style ransomware artifacts: ransom note patterns, file extension markers, and crypto library usage"
        author = "Generated for MP1 Malware Forensics Project"
        date = "2026-02-13"
        family = "LockBit-like"

    strings:
        // Ransom note keywords and typical filenames
        $note1 = "YOUR_FILES_ARE_ENCRYPTED"
        $note2 = "README_FOR_DECRYPT.txt"
        $note3 = "restore-files.txt"
        $ext_marker = ".locked"
        $ext_marker2 = ".recovered"

        // Common crypto library imports or symbols
        $crypto1 = "CryptEncrypt"
        $crypto2 = "CryptAcquireContextA"
        $openssl = "libcrypto" 

        // Process/file system behavior hints
        $fs1 = "CreateFileW"
        $fs2 = "WriteFile"
        $fs3 = "DeleteFileA"

    condition:
        uint16(0) == 0x5A4D and
        (
            // Requires either ransom-note markers in the binary or crypto APIs plus filesystem abuse
            (any of ($note*) and any of ($ext_marker*)) or
            (any of ($crypto*) and any of ($fs*))
        )
}
